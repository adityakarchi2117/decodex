MODULE A — Purchase Probability (Logistic Regression + Isotonic Calibration)
  P_raw(active) = sigmoid(b0 + sum(bi*xi))
  P_cal(active) = isotonic_regression(P_raw)  [5-fold CV calibration]
  Features : ['frequency', 'net_total', 'recency', 'n_events']
  Coefficients : [0.185393, -0.0, -0.006653, 0.003815]
  Intercept    : 0.206088
  Training AUC (raw)       : 0.8019
  Calibration: 5-fold cross-validated isotonic regression

MODULE B — Frequency Model (NegativeBinomial)
  E[freq | active] = exp(b0 + sum(bi*xi))
  Dispersion (var/mean) = 15.5471
  Features : ['frequency', 'net_total', 'recency']
  Coefficients : {'Intercept': np.float64(1.42171056), 'frequency': np.float64(0.6175632), 'net_total': np.float64(-0.06679839), 'recency': np.float64(-0.22324234), 'alpha': np.float64(0.36918802)}

MODULE C — Basket Value (OLS on log scale)
  log(basket_net) = b0 + sum(bi*xi)
  Features : ['month', 'weekday', 'hour', 'n_items', 'n_distinct', 'n_lines']
  R-squared      = 0.4085
  Adj-R-squared  = 0.4084
  Coefficients:
                   const :    10.557112  (p=0.0000e+00)
                   month :    -0.000477  (p=8.1864e-01)
                 weekday :     0.010923  (p=1.4089e-03)
                    hour :    -0.042557  (p=4.0277e-48)
                 n_items :     0.000126  (p=6.9190e-114)
              n_distinct :     0.118228  (p=7.9366e-184)
                 n_lines :    -0.073341  (p=6.6706e-82)

ERPU DECOMPOSITION
  ERPU_i = P_cal(active_i) * E[freq_i | active] * E[basket_i] * (1 - return_rate)
  P_cal  = isotonic-calibrated purchase probability (Module A)
  E[basket_i] = Module C per-user prediction (Duan smearing) shrunk toward population mean
  Population basket prior   = 109,434.19
  Duan's smearing factor    = 1.9319
  Shrinkage weight (k)      = 5 (user obs vs k baskets at population mean)
  Training return rate      = 0.0055
  Frequency cap (Y2 P99)    = 36

RETURN RISK DEFINITION
  Return Risk = Expected Return Loss = E[gross] × return_rate
  where E[gross] = P_cal(active) * E[freq] * E[basket_i]
  Return Risk Decile: users ranked by E[gross]*return_rate into 10 equal bins;
    top decile = highest expected return-loss exposure.

ASSUMPTIONS
  1. Module A probabilities are isotonic-calibrated (5-fold CV)
  2. E[basket_i] = Module C per-user with Duan's smearing, shrunk toward population mean (k=5)
  3. Return rate = population prior (training average)
  4. Frequency cap = Y2 99th percentile among active users
